<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Zeyu çš„æ‰“å¡å°ç«™ V2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* åŸºç¡€æ ·å¼ */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f4f4f4, #e0e0e0);
      margin: 30px;
      color: #333;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background: #222;
      color: #ddd;
    }
    nav {
      margin-bottom: 20px;
    }
    nav a {
      text-decoration: none;
      padding: 10px 15px;
      margin-right: 10px;
      background: #42a5f5;
      color: white;
      border-radius: 4px;
      transition: background 0.3s;
    }
    nav a:hover {
      background: #1e88e5;
    }
    h1 {
      margin-bottom: 10px;
    }
    .task {
      background: white;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: background 0.3s, transform 0.2s;
    }
    .task:hover {
      transform: scale(1.02);
    }
    .dark-mode .task {
      background: #444;
    }
    .done {
      text-decoration: line-through;
      color: gray;
    }
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      outline: none;
    }
    .tick-btn {
      background: #4caf50;
      color: white;
    }
    .reset-btn {
      background: #f44336;
      color: white;
      margin-top: 10px;
    }
    #completionRate {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">æ—¥å¸¸æ‰“å¡</a>
    <a href="weekly.html">æ¯å‘¨ç»Ÿè®¡</a>
    <a href="cultivation.html">ä¿®ä»™ä½“ç³»</a>
  </nav>
  <h1>Zeyu çš„æ¯æ—¥æ‰“å¡ V2</h1>
  <button onclick="toggleDarkMode()">ğŸŒ™ æš—é»‘æ¨¡å¼åˆ‡æ¢</button>
  <p id="quote" style="margin-top:10px; font-style: italic;"></p>
  <div id="taskList"></div>
  <p id="completionRate"></p>
  <button class="reset-btn" onclick="resetTasks()">é‡ç½®æ‰€æœ‰ä»»åŠ¡</button>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const tasks = [
      "08:30 â€“ é›…æ€å£è¯­ç»ƒä¹ ",
      "10:00 â€“ å¥èº«è®­ç»ƒ",
      "13:30 â€“ é˜…è¯»ç§‘ç ”è®ºæ–‡",
      "16:00 â€“ æ•´ç†ç§‘ç ”ç¬”è®°",
      "20:00 â€“ å°è¯´æ„æ€/å†™ä½œ",
      "21:00 â€“ æ¸¸æˆæˆ–ç”µå½±æ”¾æ¾",
      "21:30 â€“ ç»™å¥³å‹æ‰“ç”µè¯"
    ];

    // å„ä»»åŠ¡å¯¹åº”ç»éªŒå€¼ï¼Œå¥èº«ä¸ç§‘ç ”è®ºæ–‡ç»™æ›´å¤šç»éªŒ
    const xpValues = [10, 20, 20, 10, 10, 10, 10];

    const quotes = [
      "å‡¡å¿ƒæ‰€å‘ï¼Œç´ å±¥ä»¥å¾€ï¼Œç”Ÿå¦‚é€†æ—…ï¼Œä¸€è‹‡ä»¥èˆªã€‚",
      "ä½ å¯ä»¥ä¸€æ— æ‰€æœ‰ï¼Œä½†ç»ä¸èƒ½ä¸€æ— æ˜¯å¤„ã€‚",
      "æ­¤å¿ƒå…‰æ˜ï¼Œäº¦å¤ä½•è¨€ã€‚",
      "ä¸ä¸ºæ¨¡ç³Šä¸æ¸…çš„æœªæ¥æ‹…å¿§ï¼Œåªä¸ºæ¸…æ¸…æ¥šæ¥šçš„ç°åœ¨åŠªåŠ›ã€‚",
      "æ˜Ÿå…‰ä¸é—®èµ¶è·¯äººï¼Œæ—¶å…‰ä¸è´Ÿæœ‰å¿ƒäººã€‚"
    ];

    document.getElementById("quote").textContent = quotes[Math.floor(Math.random() * quotes.length)];

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function loadTasks() {
      const taskListEl = document.getElementById("taskList");
      const completionRateEl = document.getElementById("completionRate");
      taskListEl.innerHTML = "";
      let doneCount = 0;
      tasks.forEach((task, index) => {
        const done = localStorage.getItem("task_" + index) === "1";
        if (done) doneCount++;
        const taskEl = document.createElement("div");
        taskEl.className = "task" + (done ? " done" : "");

        const span = document.createElement("span");
        span.textContent = task;

        const btn = document.createElement("button");
        btn.textContent = done ? "å·²å®Œæˆ" : "æ‰“å¡";
        btn.className = "tick-btn";
        btn.onclick = () => {
          localStorage.setItem("task_" + index, done ? "0" : "1");
          loadTasks();
        };

        taskEl.appendChild(span);
        taskEl.appendChild(btn);
        taskListEl.appendChild(taskEl);
      });

      const percent = Math.round((doneCount / tasks.length) * 100);
      completionRateEl.textContent = `ä»Šæ—¥å®Œæˆç‡ï¼š${percent}%`;

      // ä¿å­˜æ¯æ—¥å®Œæˆè®°å½•ï¼ˆä¿ç•™æœ€è¿‘7å¤©æ•°æ®ï¼‰
      const today = new Date().toISOString().slice(0, 10);
      let history = JSON.parse(localStorage.getItem("weekly_data") || "{}");
      history[today] = percent;
      const sortedDates = Object.keys(history).sort().slice(-7);
      const newHistory = {};
      sortedDates.forEach(k => newHistory[k] = history[k]);
      localStorage.setItem("weekly_data", JSON.stringify(newHistory));

      // æ›´æ–°ä»Šæ—¥è·å¾—çš„ç»éªŒå€¼
      updateDailyExperience();
    }

    // æ ¹æ®ä»»åŠ¡å®Œæˆæƒ…å†µè®¡ç®—å½“å¤©ç»éªŒå€¼
    function updateDailyExperience() {
      const today = new Date().toISOString().slice(0, 10);
      const xpKey = "daily_exp_" + today;
      let xp = 0;
      tasks.forEach((_, index) => {
        if (localStorage.getItem("task_" + index) === "1") {
          xp += xpValues[index];
        }
      });
      localStorage.setItem(xpKey, xp);
    }

    // é‡ç½®æ‰€æœ‰ä»»åŠ¡
    function resetTasks() {
      tasks.forEach((_, index) => localStorage.setItem("task_" + index, "0"));
      loadTasks();
    }

    // å®šæ—¶å™¨ï¼šè®¡ç®—è·ç¦»ä¸‹ä¸€æ¬¡é›¶ç‚¹çš„æ—¶é—´ï¼Œåˆ°ç‚¹åè‡ªåŠ¨é‡ç½®ä»»åŠ¡
    function scheduleDailyReset() {
      const now = new Date();
      const nextMidnight = new Date();
      nextMidnight.setHours(24, 0, 0, 0); // è®¾ç½®è‡³ä¸‹ä¸€ä¸ªé›¶ç‚¹
      const msUntilMidnight = nextMidnight.getTime() - now.getTime();
      setTimeout(() => {
        resetTasks();
        loadTasks();
        // é€’å½’è°ƒç”¨ï¼Œç¡®ä¿ä¸‹ä¸€å¤©ç»§ç»­è‡ªåŠ¨é‡ç½®
        scheduleDailyReset();
      }, msUntilMidnight);
    }

    // åˆå§‹åŠ è½½ä»»åŠ¡å¹¶å¯åŠ¨æ¯æ—¥è‡ªåŠ¨é‡ç½®è®¡æ—¶å™¨
    loadTasks();
    scheduleDailyReset();
  </script>
</body>
</html>

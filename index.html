<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Zeyu çš„æ‰“å¡å°ç«™ V2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background-color: #f4f4f4;
      color: #333;
      margin: 30px;
      transition: all 0.3s;
    }
    .dark-mode {
      background-color: #222;
      color: #ddd;
    }
    .task {
      background: white;
      color: black;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .dark-mode .task {
      background: #444;
      color: #ddd;
    }
    .done {
      text-decoration: line-through;
      color: gray;
    }
    button {
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .tick-btn {
      background: #4caf50;
      color: white;
    }
    .reset-btn {
      background: #f44336;
      color: white;
      margin-top: 10px;
    }
    canvas {
      margin-top: 20px;
      max-width: 100%;
    }
  </style>
</head>
<body>
  <h1>Zeyu çš„æ¯æ—¥æ‰“å¡ V2</h1>
  <button onclick="toggleDarkMode()">ğŸŒ™ æš—é»‘æ¨¡å¼åˆ‡æ¢</button>
  <p id="quote" style="margin-top:10px; font-style: italic;"></p>
  <div id="taskList"></div>
  <p id="completionRate"></p>
  <button class="reset-btn" onclick="resetTasks()">é‡ç½®æ‰€æœ‰ä»»åŠ¡</button>
  <canvas id="weeklyChart" height="200"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const tasks = [
      "08:30 â€“ é›…æ€å£è¯­ç»ƒä¹ ",
      "10:00 â€“ å¥èº«è®­ç»ƒ",
      "13:30 â€“ é˜…è¯»ç§‘ç ”è®ºæ–‡",
      "16:00 â€“ æ•´ç†ç§‘ç ”ç¬”è®°",
      "20:00 â€“ å°è¯´æ„æ€/å†™ä½œ",
      "21:00 â€“ æ¸¸æˆæˆ–ç”µå½±æ”¾æ¾",
      "21:30 â€“ ç»™å¥³å‹æ‰“ç”µè¯"
    ];

    const quotes = [
      "å‡¡å¿ƒæ‰€å‘ï¼Œç´ å±¥ä»¥å¾€ï¼Œç”Ÿå¦‚é€†æ—…ï¼Œä¸€è‹‡ä»¥èˆªã€‚",
      "ä½ å¯ä»¥ä¸€æ— æ‰€æœ‰ï¼Œä½†ç»ä¸èƒ½ä¸€æ— æ˜¯å¤„ã€‚",
      "æ­¤å¿ƒå…‰æ˜ï¼Œäº¦å¤ä½•è¨€ã€‚",
      "ä¸ä¸ºæ¨¡ç³Šä¸æ¸…çš„æœªæ¥æ‹…å¿§ï¼Œåªä¸ºæ¸…æ¸…æ¥šæ¥šçš„ç°åœ¨åŠªåŠ›ã€‚",
      "æ˜Ÿå…‰ä¸é—®èµ¶è·¯äººï¼Œæ—¶å…‰ä¸è´Ÿæœ‰å¿ƒäººã€‚"
    ];

    document.getElementById("quote").textContent = quotes[Math.floor(Math.random() * quotes.length)];

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function loadTasks() {
      const taskListEl = document.getElementById("taskList");
      const completionRateEl = document.getElementById("completionRate");
      taskListEl.innerHTML = "";
      let doneCount = 0;
      tasks.forEach((task, index) => {
        const done = localStorage.getItem("task_" + index) === "1";
        if (done) doneCount++;
        const taskEl = document.createElement("div");
        taskEl.className = "task" + (done ? " done" : "");

        const span = document.createElement("span");
        span.textContent = task;

        const btn = document.createElement("button");
        btn.textContent = done ? "å·²å®Œæˆ" : "æ‰“å¡";
        btn.className = "tick-btn";
        btn.onclick = () => {
          localStorage.setItem("task_" + index, done ? "0" : "1");
          loadTasks();
        };

        taskEl.appendChild(span);
        taskEl.appendChild(btn);
        taskListEl.appendChild(taskEl);
      });

      const percent = Math.round((doneCount / tasks.length) * 100);
      completionRateEl.textContent = `ä»Šæ—¥å®Œæˆç‡ï¼š${percent}%`;

      // ä¿å­˜æ¯æ—¥å®Œæˆè®°å½•
      const today = new Date().toISOString().slice(0, 10);
      let history = JSON.parse(localStorage.getItem("weekly_data") || "{}");
      history[today] = percent;
      const sorted = Object.keys(history).sort().slice(-7); // ä¿ç•™æœ€è¿‘7å¤©
      const newHistory = {};
      sorted.forEach(k => newHistory[k] = history[k]);
      localStorage.setItem("weekly_data", JSON.stringify(newHistory));

      drawChart(newHistory);
    }

    function resetTasks() {
      tasks.forEach((_, index) => localStorage.setItem("task_" + index, "0"));
      loadTasks();
    }

    function drawChart(data) {
      const ctx = document.getElementById("weeklyChart").getContext("2d");
      const labels = Object.keys(data);
      const values = Object.values(data);
      if (window.chartInstance) window.chartInstance.destroy();
      
      const gradient = ctx.createLinearGradient(0, 0, 0, 200);
      gradient.addColorStop(0, "#42a5f5");
      gradient.addColorStop(1, "#bbdefb");

      window.chartInstance = new Chart(ctx, {
    
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'æ‰“å¡å®Œæˆç‡ï¼ˆè¿‡å»7å¤©ï¼‰',
            backgroundColor: gradient,
            borderColor: '#1e88e5',
            pointBackgroundColor: '#ffffff',
            pointBorderColor: '#1e88e5',
            pointRadius: 5,
            pointHoverRadius: 8,

            label: 'æ¯æ—¥å®Œæˆç‡',
            data: values,
            borderColor: '#42a5f5',
            fill: false,
            tension: 0.2
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            y: {
              max: 100,
              min: 0,
              ticks: {
                stepSize: 20,
                callback: function(value) { return value + '%' }
              },
              title: { display: true, text: 'å®Œæˆç‡ (%)', color: '#888' }
            },
            x: {
              title: { display: true, text: 'æ—¥æœŸ', color: '#888' }
            }
          }
        }
      });
    }

    loadTasks();
  </script>
</body>
</html>

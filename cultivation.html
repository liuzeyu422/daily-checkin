<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Zeyu çš„ä¿®ä»™ä½“ç³»</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f4f4f4, #e0e0e0);
      margin: 30px;
      color: #333;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background: #222;
      color: #ddd;
    }
    nav {
      margin-bottom: 20px;
    }
    nav a {
      text-decoration: none;
      padding: 10px 15px;
      margin-right: 10px;
      background: #42a5f5;
      color: white;
      border-radius: 4px;
      transition: background 0.3s;
    }
    nav a:hover {
      background: #1e88e5;
    }
    h1 {
      margin-bottom: 20px;
    }
    .cultivation-panel {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      margin-bottom: 20px;
    }
    .progress-bar {
      width: 100%;
      background: #eee;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-inner {
      height: 20px;
      width: 0%;
      background: linear-gradient(90deg, #42a5f5, #1e88e5);
      text-align: center;
      line-height: 20px;
      color: white;
      transition: width 0.5s ease-out;
    }
    .upgrade-effect {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      padding: 20px 30px;
      border-radius: 8px;
      font-size: 1.2em;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
    }
    .blind-box {
      background: #ffe082;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: background 0.3s;
    }
    .blind-box:hover {
      background: #ffd54f;
    }
    .hidden-message {
      display: none;
      margin-top: 15px;
      padding: 10px;
      background: #c5e1a5;
      border-radius: 4px;
    }
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      outline: none;
    }
    .toggle-btn {
      background: #4caf50;
      color: white;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">æ—¥å¸¸æ‰“å¡</a>
    <a href="weekly.html">æ¯å‘¨ç»Ÿè®¡</a>
    <a href="cultivation.html">ä¿®ä»™ä½“ç³»</a>
  </nav>
  <h1>Zeyu çš„ä¿®ä»™ä½“ç³»</h1>
  <button class="toggle-btn" onclick="toggleDarkMode()">ğŸŒ™ æš—é»‘æ¨¡å¼åˆ‡æ¢</button>
  
  <div class="cultivation-panel">
    <div id="xpDisplay">å½“å‰ç»éªŒï¼š0 / 0</div>
    <div id="levelDisplay">å½“å‰å¢ƒç•Œï¼šæœªçŸ¥</div>
    <div class="progress-bar">
      <div id="progressInner" class="progress-inner">0%</div>
    </div>
  </div>
  
  <!-- æœ€é«˜å¢ƒç•Œæ—¶æ˜¾ç¤ºçš„ç›²ç›’ -->
  <div id="blindBox" class="blind-box" style="display: none;">
    ğŸ æ‰“å¼€ç›²ç›’ï¼Œé¢†å–ä½ çš„ç»ˆæå¥¥ä¹‰
  </div>
  <div id="blindMessage" class="hidden-message">
    å¤©åœ°ç„é»„ï¼Œå®‡å®™æ´ªè’ï¼›ä¿®ä»™ä¸€é€”ï¼Œè‡³é«˜æ— ä¸Šï¼<br>
    ä½ å·²ç™»ä»™æˆåœ£ï¼Œåˆ‡è®°ä¸–é—´ä¸‡è±¡çš†å¦‚å¹»ï¼Œå”¯å¿ƒä¸­é‚£ä»½æ‰§å¿µæ°¸å­˜ï¼
  </div>
  
  <!-- å‡çº§ç‰¹æ•ˆ -->
  <div id="upgradeEffect" class="upgrade-effect"></div>
  
  <script>
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }
    
    // å®šä¹‰ 15 ä¸ªå¢ƒç•ŒåŠå…¶ç»éªŒé—¨æ§›ï¼ˆå•ä½ï¼šç»éªŒå€¼ï¼‰
    const levels = [
      { level: 1, name: "å‡¡ä½“åˆæˆ", threshold: 0 },
      { level: 2, name: "ç‚¼æ°”æœŸå…¥é—¨", threshold: 90 },
      { level: 3, name: "èšçµå¢ƒåˆæ¢", threshold: 180 },
      { level: 4, name: "ç­‘åŸºæœŸåˆæˆ", threshold: 270 },
      { level: 5, name: "ç»“ä¸¹æœŸå¼€åŸº", threshold: 360 },
      { level: 6, name: "å…ƒå©´æœŸåˆç°", threshold: 450 },
      { level: 7, name: "å½’è™šå¢ƒç•¥æ˜¾", threshold: 540 },
      { level: 8, name: "çµé­‚åˆä¸€", threshold: 630 },
      { level: 9, name: "é£å‡å‰å¥", threshold: 720 },
      { level: 10, name: "å¤©å‘½é€šè¾¾", threshold: 810 },
      { level: 11, name: "çœŸä»™å†ä¸´", threshold: 900 },
      { level: 12, name: "æ³•åˆ™é€šæ™“", threshold: 990 },
      { level: 13, name: "æ˜Ÿæ²³è€€ç›®", threshold: 1080 },
      { level: 14, name: "ä¸‡æ³•å½’å®—", threshold: 1170 },
      { level: 15, name: "ç™»ä»™æˆåœ£", threshold: 1260 }
    ];
    
    // è®¡ç®—ç´¯è®¡ç»éªŒï¼šéå† localStorage æ‰€æœ‰ä»¥ "daily_exp_" å¼€å¤´çš„é”®
    function calculateCumulativeXP() {
      let totalXP = 0;
      for (let key in localStorage) {
        if (key.indexOf("daily_exp_") === 0) {
          totalXP += Number(localStorage.getItem(key));
        }
      }
      return totalXP;
    }
    
    // æ ¹æ®ç´¯è®¡ç»éªŒè®¡ç®—å½“å‰å¢ƒç•Œå’Œä¸‹ä¸€çº§æ‰€éœ€ç»éªŒ
    function getCultivationStatus(xp) {
      let current = levels[0];
      for (let lvl of levels) {
        if (xp >= lvl.threshold) {
          current = lvl;
        }
      }
      // è·å–ä¸‹ä¸€çº§é—¨æ§›ï¼ˆå¦‚æœæœªè¾¾åˆ°æœ€é«˜å¢ƒç•Œï¼‰
      let next = levels.find(lvl => lvl.threshold > xp);
      return { current, next };
    }
    
    // æ˜¾ç¤ºå‡çº§ç‰¹æ•ˆï¼ˆåŠ¨ç”»æç¤ºå‡çº§ä¿¡æ¯ï¼‰
    function showUpgradeEffect(message) {
      const effectDiv = document.getElementById("upgradeEffect");
      effectDiv.textContent = message;
      effectDiv.style.display = "block";
      setTimeout(() => {
        effectDiv.style.display = "none";
      }, 2000);
    }
    
    // åˆ·æ–°ä¿®ä»™çŠ¶æ€ä¿¡æ¯
    function updateCultivation() {
      const xp = calculateCumulativeXP();
      const status = getCultivationStatus(xp);
      const xpDisplay = document.getElementById("xpDisplay");
      const levelDisplay = document.getElementById("levelDisplay");
      const progressInner = document.getElementById("progressInner");
      
      xpDisplay.textContent = `å½“å‰ç»éªŒï¼š${xp} / ${status.next ? status.next.threshold : xp}`;
      levelDisplay.textContent = `å½“å‰å¢ƒç•Œï¼š${status.current.name}ï¼ˆ${status.current.level} çº§ï¼‰`;
      
      let progressPercent;
      if (status.next) {
        progressPercent = Math.floor(((xp - status.current.threshold) / (status.next.threshold - status.current.threshold)) * 100);
      } else {
        progressPercent = 100;
      }
      progressInner.style.width = progressPercent + '%';
      progressInner.textContent = progressPercent + '%';
      
      // æ£€æŸ¥æ˜¯å¦å·²è¾¾æœ€é«˜å¢ƒç•Œ
      if (status.current.level === levels[levels.length - 1].level) {
        document.getElementById("blindBox").style.display = "block";
      }
      
      // å‡çº§ç‰¹æ•ˆï¼šè‹¥æ¯”ä¸Šæ¬¡è®°å½•çš„å¢ƒç•Œæå‡ï¼Œåˆ™æ˜¾ç¤ºç‰¹æ•ˆæç¤º
      let lastLevel = Number(localStorage.getItem("last_cultivation_level") || 0);
      if (status.current.level > lastLevel) {
        showUpgradeEffect(`æ­å–œï¼ä½ å·²çªç ´è‡³ã€${status.current.name}ã€‘`);
        localStorage.setItem("last_cultivation_level", status.current.level);
      }
    }
    
    // ç»‘å®šç›²ç›’ç‚¹å‡»äº‹ä»¶ï¼Œå±•ç¤ºæœ€ç»ˆå¥¥ä¹‰
    document.getElementById("blindBox").onclick = function() {
      const blindMsg = document.getElementById("blindMessage");
      if (blindMsg.style.display === "none" || blindMsg.style.display === "") {
        blindMsg.style.display = "block";
      } else {
        blindMsg.style.display = "none";
      }
    };
    
    updateCultivation();
  </script>
</body>
</html>
